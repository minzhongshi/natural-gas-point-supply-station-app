"use strict";const e=require("../../../common/vendor.js"),a=require("../../../uni_modules/u-ajax/js_sdk/index.js"),t=require("../../../api/user/dictionary.js"),s=require("../../../api/user/device.js"),o=require("../../../stores/counter.js");require("../../../uni_modules/u-ajax/js_sdk/lib/core/Ajax.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/core/InterceptorManager.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/helpers/buildURL.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/utils.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/helpers/mergeConfig.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/core/dispatchRequest.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/helpers/isCallback.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/defaults.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/adapters/http.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/core/handleCancel.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/adapters/Fetcher.js");const i=o.userAccountStore(),r={components:{htzImageUpload:()=>"../../../components/htz-image-upload/htz-image-upload.js"},data:()=>({range:[],dataTree:[],uri:t.API.PUSH_VEDIO,headers:{"Content-Type":"multipart/form-data"},baseFormData:{typesOf:"",site:"",textDescription:"",video:[],siteId:""},rules:{typesOf:{rules:[{required:!0,errorMessage:"类型不能为空"}]},site:{rules:[{required:!0,errorMessage:"站点不能为空"}]},textDescription:{rules:[{required:!0,errorMessage:"文字描述不能为空"}]}}}),created(){this.reportType()},methods:{submit(s){this.$refs[s].validate().then((s=>{a.ajax.post({url:t.API.PUSH_MESSAGE,data:{accountId:i.information.id,name:i.information.username,content:this.baseFormData.textDescription,video:this.baseFormData.video[0],type:this.baseFormData.typesOf,site:this.baseFormData.site,siteId:this.baseFormData.siteId}}).then((a=>{200===a.data.code?(this.getLog("上报了一条消息",this.baseFormData.textDescription,this.baseFormData.video[0]),e.index.showToast({title:"上报成功",duration:1e3}),e.index.navigateBack({delta:1})):e.index.showToast({title:a.data.msg,duration:1e3})}))})).catch((e=>{console.log("err",e)}))},ceshiUploadSuccess(e){var a=JSON.parse(e.data);if(200==a.code){let e=[];e.push("http://192.168.1.7:8006"+a.data),console.log(e),this.baseFormData.video=e}},uploadFail(a){e.index.showToast({title:"上传失败",icon:"none",duration:1e3})},reportType(){a.ajax.get({url:`${t.API.PUSH_DICTIONARY}report-type`}).then((a=>{if(200===a.data.code)for(let e in a.data.data){let t={text:a.data.data[e].dictLabel,value:a.data.data[e].dictLabel};this.range.push(t)}else e.index.showToast({title:a.data.msg,duration:1e3})})),a.ajax.post({url:s.API.DEVIE_SITE,data:{}}).then((a=>{if(200===a.data.code){let e=[];for(let t in a.data.data){let s={text:a.data.data[t].name,value:a.data.data[t].standId};e.push(s)}this.dataTree=e,console.log(this.dataTree)}else e.index.showToast({title:a.data.msg,duration:1e3})}))},onchange(e){this.baseFormData.siteId=e.detail.value[0].value,this.baseFormData.site=e.detail.value[0].text},getLog(t,o,r){a.ajax.post({url:s.API.DEVIE_LOG,data:{siteId:this.baseFormData.siteId,siteName:this.baseFormData.site,operationContent:t,operationName:i.information.username,content:o,video:r}}).then((a=>{200===a.data.code||e.index.showToast({icon:"error",title:"日志记录失败",duration:2e3})}))}}};if(!Array){(e.resolveComponent("uni-data-select")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-picker")+e.resolveComponent("uni-easyinput")+e.resolveComponent("htz-image-upload")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-section"))()}Math||((()=>"../../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker.js")+(()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../components/htz-image-upload/htz-image-upload.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../../uni_modules/uni-section/components/uni-section/uni-section.js"))();const n=e._export_sfc(r,[["render",function(a,t,s,o,i,r){return{a:e.o((e=>i.baseFormData.typesOf=e)),b:e.p({localdata:i.range,modelValue:i.baseFormData.typesOf}),c:e.p({label:"上报类型",required:!0,name:"typesOf"}),d:e.o(r.onchange),e:e.o((e=>i.baseFormData.site=e)),f:e.p({"popup-title":"请选择站点",placeholder:"请选择站点",localdata:i.dataTree,modelValue:i.baseFormData.site}),g:e.p({label:"上报站点",required:!0,name:"site"}),h:e.o((e=>i.baseFormData.textDescription=e)),i:e.p({type:"textarea",placeholder:"请输入文字描述",modelValue:i.baseFormData.textDescription}),j:e.p({label:"文字描述",required:!0,name:"textDescription"}),k:e.o(r.ceshiUploadSuccess),l:e.o(r.uploadFail),m:e.o((e=>i.baseFormData.video=e)),n:e.p({dataType:"0",mediaType:"video",name:"vide",max:1,action:i.uri,headers:i.headers,modelValue:i.baseFormData.video}),o:e.p({label:"上报视频"}),p:e.sr("valiForm","6588f97c-1,6588f97c-0"),q:e.p({rules:i.rules,modelValue:i.baseFormData,"label-position":"top"}),r:e.o((e=>r.submit("valiForm"))),s:e.p({title:"信息上报",type:"line"})}}]]);wx.createPage(n);
