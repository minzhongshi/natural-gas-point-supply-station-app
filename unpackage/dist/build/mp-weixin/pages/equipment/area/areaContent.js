"use strict";const e=require("../../../common/vendor.js"),t=require("../../../api/user/device.js"),a=require("../../../uni_modules/u-ajax/js_sdk/index.js"),i=require("../../../stores/counter.js");require("../../../uni_modules/u-ajax/js_sdk/lib/core/Ajax.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/core/InterceptorManager.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/helpers/buildURL.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/utils.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/helpers/mergeConfig.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/core/dispatchRequest.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/helpers/isCallback.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/defaults.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/adapters/http.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/core/handleCancel.js"),require("../../../uni_modules/u-ajax/js_sdk/lib/adapters/Fetcher.js");const s=i.userAccountStore(),o={components:{areaMonitor:()=>"./areaMonitor.js",eject:()=>"./eject/eject.js",modify:()=>"./eject/modify.js"},data:()=>({data:[],partition:[],modify:{},index:"0",checked:!1,isShow:!0,device:"",standId:"",time:"",name:"",btext:{0:"正常",1:"异常",2:"离线"},bcolor:{0:"#42B983",1:"#E32631",2:"#505050"}}),onLoad(t){let a=JSON.parse(decodeURIComponent(t.data));this.standId=a.standId,this.time=a.time,this.checked="2"!==a.state,this.device="2"===a.state?"设备离线":"启用中",this.name=a.name,e.index.setNavigationBarTitle({title:a.name||"燃气站"})},created(){},onShow(){this.getDevice(),this.getPartition()},methods:{open(e){this.$refs.popup.open(),this.$refs.child.open(e)},showDrawer(e){this.$refs[e].open()},closeDrawer(e){this.$refs[e].close()},openConfirm(){e.index.showModal({title:"提示",content:"确认修改参数吗？",success:i=>{i.confirm&&(e.index.showLoading({title:"修改中"}),a.ajax.post({url:t.API.DEVIE_MODIFY,data:{standId:this.standId,...this.modify}}).then((t=>{200===t.data.code?(this.getLog("修改了设备阈值"),this.partition=t.data.data):e.index.showToast({icon:"error",title:t.data.msg,duration:2e3}),e.index.hideLoading()})))}}),this.getDevice(),this.getPartition()},switchChange:function(i){i.detail.value?(a.ajax.post({url:t.API.DEVIE_CONTROLLER,data:{standId:this.standId,state:"0"}}).then((t=>{200===t.data.code?(this.getLog("启动了设备"),this.device="启用中",this.checked=!0,e.index.showToast({title:"开启成功",icon:"success",duration:2e3})):e.index.showToast({title:t.data.msg,duration:1e3})})),this.getDevice(),this.getPartition()):e.index.showModal({title:"提示",content:"确定要关闭设备吗？",success:i=>{i.confirm?(a.ajax.post({url:t.API.DEVIE_CONTROLLER,data:{standId:this.standId,state:"2"}}).then((t=>{200===t.data.code?(this.getLog("关闭了设备"),this.device="设备离线",this.checked=!1,e.index.showToast({title:"关闭成功",icon:"success",duration:2e3})):e.index.showToast({title:t.data.msg,duration:1e3})})),this.getDevice(),this.getPartition()):(this.isShow=!1,this.checked=!0,this.$nextTick((()=>{this.isShow=!0})))}})},getDevice(){e.index.showLoading({title:"加载中"}),a.ajax.post({url:t.API.DEVIE_DEVICE,data:{standId:this.standId},header:{"Content-type":"application/x-www-form-urlencoded"}}).then((t=>{200===t.data.code?this.data=t.data.data:e.index.showToast({icon:"error",title:t.data.msg,duration:2e3}),e.index.hideLoading()}))},getPartition(){e.index.showLoading({title:"加载中"}),a.ajax.post({url:t.API.DEVIE_PARTITION,data:{standId:this.standId}}).then((t=>{200===t.data.code?this.partition=t.data.data:e.index.showToast({icon:"error",title:t.data.msg,duration:2e3}),e.index.hideLoading()}))},getMsg(e){this.modify=e},getLog(i){const o={...this.modify},n=`瞬时流量下限:${o.flowBelow} 瞬时流量上限:${o.flowUppere} 气化区燃气浓度上限:${o.vaporizeGas} 燃气浓度上限:${o.gas} 压力下限:${o.pressureBelowe} 压力上限:${o.pressureUppere}`;a.ajax.post({url:t.API.DEVIE_LOG,data:{siteId:this.standId,siteName:this.name,operationContent:i,operationName:s.information.username,content:n,video:""}}).then((t=>{200===t.data.code||e.index.showToast({icon:"error",title:"日志记录失败",duration:2e3})}))}}};if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("areaMonitor")+e.resolveComponent("uni-group")+e.resolveComponent("uni-section")+e.resolveComponent("eject")+e.resolveComponent("uni-popup")+e.resolveComponent("modify")+e.resolveComponent("uni-drawer"))()}Math||((()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-group/components/uni-group/uni-group.js")+(()=>"../../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../../uni_modules/uni-drawer/components/uni-drawer/uni-drawer.js"))();const n=e._export_sfc(o,[["render",function(t,a,i,s,o,n){return e.e({a:e.p({type:"circle-filled",color:o.bcolor[this.partition[0].state]}),b:e.t(o.btext[this.partition[0].state]),c:o.bcolor[this.partition[0].state],d:e.o((e=>n.showDrawer("showRight"))),e:e.o((e=>n.open("0"))),f:e.p({name:"储罐压力",price:this.data.storageTank[0].price+" kpa",state:o.data.storageTank[0].state,show:"true"}),g:e.o((e=>n.open("1"))),h:e.p({name:"储罐液位",price:o.data.storageTank[1].price+" mmH2o",state:o.data.storageTank[1].state,show:"true"}),i:e.o((e=>n.open("2"))),j:e.p({name:"燃气浓度",price:o.data.storageTank[2].price+" %LEL",state:o.data.storageTank[2].state,show:"true"}),k:e.o((e=>n.open("3"))),l:e.p({name:"气化区燃气浓度",price:o.data.storageTank[3].price+" %LEL",state:o.data.storageTank[3].state,show:"true"}),m:e.p({name:"当前体积",price:o.data.storageTank[4].price+" m³",state:o.data.storageTank[4].state}),n:e.p({name:"当前气体体积",price:o.data.storageTank[5].price+" m³",state:o.data.storageTank[5].state}),o:e.p({name:"当前质量",price:o.data.storageTank[6].price+" t",state:o.data.storageTank[6].state}),p:e.p({name:"最大补液体积",price:o.data.storageTank[7].price+" m³",state:o.data.storageTank[7].state}),q:e.p({name:"最大补液质量",price:o.data.storageTank[8].price+" t",state:o.data.storageTank[8].state}),r:e.p({name:"剩余液位",price:o.data.storageTank[9].price+" %",state:o.data.storageTank[9].state}),s:e.p({mode:"card"}),t:e.p({title:"储罐区","sub-title":o.time||"时间未统计",titleFontSize:"18px",titleColor:"#2979FF",subTitleFontSize:"16px",type:"circle"}),v:e.p({type:"circle-filled",color:o.bcolor[this.partition[1].state]}),w:e.t(o.btext[this.partition[1].state]),x:o.bcolor[this.partition[1].state],y:e.p({name:"瞬时流量",price:o.data.flowmeter[10].price+" m/s",state:o.data.flowmeter[10].state}),z:e.p({name:"流量计温度",price:o.data.flowmeter[11].price+" ℃",state:o.data.flowmeter[11].state}),A:e.p({mode:"card"}),B:e.p({title:"流量计区","sub-title":o.time||"时间未统计",titleFontSize:"18px",titleColor:"#2979FF",subTitleFontSize:"16px",type:"circle"}),C:e.sr("child","0c3b2fbd-19,0c3b2fbd-18"),D:e.p({standId:o.standId}),E:e.sr("popup","0c3b2fbd-18"),F:e.p({type:"bottom"}),G:e.t(this.device),H:o.isShow},o.isShow?{I:e.o(((...e)=>n.switchChange&&n.switchChange(...e))),J:o.checked}:{},{K:e.o(n.getMsg),L:o.checked,M:e.o((e=>n.closeDrawer("showRight"))),N:o.checked,O:e.o(((...e)=>n.openConfirm&&n.openConfirm(...e))),P:e.sr("showRight","0c3b2fbd-20"),Q:e.p({mode:"right"})})}],["__scopeId","data-v-0c3b2fbd"]]);wx.createPage(n);
